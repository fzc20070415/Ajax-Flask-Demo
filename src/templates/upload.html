<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Video Upload Page</title>
    <script src="//oss.maxcdn.com/jquery/2.1.4/jquery.min.js"></script>

    <link rel="stylesheet" href="//oss.maxcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="//oss.maxcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"> -->
    <!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script> -->


  </head>
  <body>
    <div class="container-fluid">
        <br><br><br>
        <div class="row">
            <div class="col-md-2">

            </div>
            <div class="col-md-8">
                <div class="panel panel-default">
                    <div class="panel-heading bg-dark">
                        <h1>Video Upload</h1>
                    </div>
                    <div class="panel-body">

                        <div class="row">
                            <form id="form" class="" action="/upload" method="post"  enctype=multipart/form-data onsubmit="event.preventDefault(); return final();">
                                <!-- <input type="file" accept="video/*"> -->
                                <!-- <input id="file" name="file" type="file" accept="video/*">    -->
                                <!-- <div class="form-group"> -->
                                <!-- <div class="btn btn-primary float-left"> -->
                                <!-- <span>Choose file</span> -->
                                <div class="row">
                                    <div class="col-md-1">

                                    </div>
                                    <div class="col-md-8" style="height:50px">
                                        <!-- <input class="well" id="file" name="file" type="file" accept="video/*" style="width:100%">-->
                                        <input class="well" id="file" name="file" type="file" accept=".mp4,.avi" style="width:100%">   <!-- IMG for testing purpose -->
                                    </div>
                                    <!-- </div> -->
                                    <div class="col-md-1" style="height:50px; padding-top:7px">
                                        <input type="submit" id="btn" class="btn btn-primary btn-lg disabled" value="Upload" style="">
                                    </div>
                                </div>
                                <!-- </div> -->
                                <!-- <input type="text" name="what" value="1234"> -->
                                <!-- <div class="form-group row">
                                    <div class="col-md-2">

                                    </div>
                                    <label for="staticEmail" class="col-md-2 col-form-label">Email</label>
                                    <div class="col-md-6">
                                    <input type="text" readonly class="form-control-plaintext" id="staticEmail" value="email@example.com">
                                    </div>
                                </div> -->

                            </form>
                            <!-- <button onclick=check_size()>Check Size</button> -->
                        </div>
                        <div class="row">
                            <!-- <div class="progress">
                            <div class="progress-bar" role="progressbar" aria-valuenow="70"
                            aria-valuemin="0" aria-valuemax="100" style="width:70%">
                                    70%
                                </div>
                            </div> -->

                            <!-- <div class="col-md-2">

                            </div> -->
                            <!-- <div class="col-md-10" id="infos" style=""></div> -->

                            <br>

                            <div class="" id="Feedback" style="color:red; margin-left:10%">
                                {{ feedback | safe }}
                            </div>

                        </div>

                    </div>


                    <div class="panel-footer">
                        <!-- <hr> -->
                        <div class="">
                            Note: </br>
                            &nbsp; &nbsp; &nbsp; &nbsp; Accepted video formats: mp4, avi</br>
                            &nbsp; &nbsp; &nbsp; &nbsp; Maximum file size acceptable: 100MB</br>
                            &nbsp; &nbsp; &nbsp; &nbsp; Maximum video length acceptable: 1 minute
                        </div>
                        <!-- <br> -->


                    </div>


                </div>

            </div>

        </div>

    </div>


    <!-- Button trigger modal -->
<button type="button" class="btn btn-primary hidden" data-toggle="modal" data-target="#ModalLong">
  Launch modal
</button>

<!-- Modal -->
<div class="modal fade" id="ModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="ModalLongTitle">User Agreement
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
        </h3>
      </div>
      <div class="modal-body">
          1. GENERAL
          <br>
          By uploading a video, you guarantee that you have read these Terms and Conditions for uploading videos (Video/s) to the X-ToM system and that you agree to abide by all clauses within these Terms and Conditions.
          <br><br>
          2. COPYRIGHT OWNERSHIP
          <br>
          By uploading a Video to the X-ToM system you guarantee that you are the legal owner of the copyright of that video, or you have been awarded full and unrestricted rights from the copyright owner to upload and utilize the Video for the purposes of the X-ToM system. Videos that are considered to infringe the copyright or trademarks of other individuals, organizations or companies will be deleted.
          <br><br>
          3. THIRD PARTY RIGHTS
          <br>
          By uploading a video, you guarantee that such use of the video in the X-ToM system does not violate the rights of any other party, does not result in a breach of contract between you and another party and that you accept responsibility for any royalties or fees due to any other party from the use of the uploaded video.
          <br><br>
          4. PEOPLE SEEN IN VIDEOS
          <br>
          By uploading a video, you guarantee that any people which are clearly identifiable have consented to have their likeness printed or displayed, or that you have full rights to use the video in this manner and accept full responsibility for such use.
          <br><br>
          5. ACCEPTING AND REJECTING VIDEOS
          <br>
          All videos uploaded to the X-ToM system will be assessed for suitability. X-ToM system reserves the right to reject and remove any uploaded video from display on its website, for any reason, at any time, without prior notice.
          <br><br>
          6. RESPONSIBILITY FOR CONTENT
          <br>
          When uploading a video, you are solely responsible for its content and for any offence, claims or damages that arise from the content of that video. The approval and publication of videos in no way alters or diminishes your responsibility, nor does it transfer any responsibility for the content of the video to whom approves the video for publication.
          <br><br>
          7. RIGHTS GRANTED TO X-TOM SYSTEM
          <br>
          X-ToM system does not claim any copyright or any kind of ownership rights to the videos you uploaded. However, by uploading a video to the X-ToM system you thereby grant a royalty-free, non-exclusive, worldwide right to copy, crop, reproduce, edit, publish, display, distribute or otherwise use the video publicly, whether now known or hereinafter devised, including without limitation including in the Guides in perpetuity.
          <br><br>
          8. VIDEO CONTENT
          <br>
          You should only upload videos that are relevant and appropriate to your campsite.
          <br>
          Videos including overlays such as logos, text or star ratings will not be approved as these do not render well in our print publications. You must not upload photographs that contain objectionable content, including but not limited to nudity, violence, and other offensive, illegal or inappropriate videos or videos. X-ToM system reserves the right to delete videos considered potentially offensive to some as 'sensitive'.
          <br><br>
          <div class="form-group row">
              <div class="row" style="margin-left:5%;margin-right:5%">
                  <div class="col-md-2">
                      <label for="staticEmail" class="col-form-label">Your Email</label>
                  </div>
                  <div class="col-md-10">
                      <input type="text" spellcheck="false"class="form-control" id="staticEmail" value="">
                  </div>
              </div>
              <div class="row" style="margin-left:5%;margin-right:5%">
                  <div class="col-md-2">
                      <label for="staticEmail" class="col-form-label">Re-enter Email</label>
                  </div>
                  <div class="col-md-10">
                      <input type="text" spellcheck="false"class="form-control" id="staticEmail2" value="">
                  </div>
              </div>
          </div>
          <div class="row" id="Email_Reminder" style="color: red; text-align: center">

          </div>

      </div>
      <div class="modal-footer">
        <button id='modal_btn' type="button" class="btn btn-primary">Upload</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

  </body>

  <script>
    var myVideos = [];
    var submission_indicator = 0;
    // var LIMIT = 1000;

    document.getElementById('file').onchange = setFileInfo;
    document.getElementById('modal_btn').onclick = final2;

    //Add hidden form input for submitting extra information
    // window.onload = function(){
    //     var form = document.getElementById("form");
    //     var input = document.createElement("input");
    //     input.setAttribute("type", "hidden");
    //     input.setAttribute("name", "Total_Chunk_Number");
    //     input.setAttribute("value", "10");
    //     form.appendChild(input);
    //     console.log("LOG")
    //     console.log(form);
    // }

    function setFileInfo() {
        document.getElementById("Feedback").style.color = 'red';
        output = true;
        submission_indicator = 1;
        if (check_size()){
            var files = this.files;
            console.log(files);
            try{
                console.log(files[0]);
                myVideos.push(files[0]);
            }
            catch (e){
                console.error("Exception thrown", e);
            }
            var video = document.createElement('video');
            video.preload = 'metadata';

            video.onloadedmetadata = function() {
                var duration = video.duration;
                myVideos[myVideos.length - 1].duration = duration;
                // alert(duration + files[0].name)
                updateInfos();
                if (duration > 60){
                    document.getElementById("Feedback").style.color = 'red';
                    document.getElementById("Feedback").innerHTML = "The video is too long.";
                    output = false;
                    submission_indicator = 0;
                    console.log("cp5")
                    if (!document.getElementById("btn").classList.contains("disabled")){
                        console.log("cp2")
                        document.getElementById("btn").classList.add("disabled");
                    }
                }
            }
            try{
                video.src = URL.createObjectURL(files[0]);
            }
            catch (e){
                console.error("Exception thrown", e);
                // exit(1)
            }
        }
        else{
            output = false;
            submission_indicator = 0;
        }
        console.log("submission_indicator:" + submission_indicator)
        if (submission_indicator == 1){
            console.log("cp3")
            if (document.getElementById("btn").classList.contains("disabled")){
                document.getElementById("btn").classList.remove("disabled");
            }
        }
        else{
            console.log("cp1")
            if (!document.getElementById("btn").classList.contains("disabled")){
                console.log("cp2")
                document.getElementById("btn").classList.add("disabled");
            }
        }
        return output;
    }


    function updateInfos() {
        // var infos = document.getElementById('infos');
        // infos.textContent = "";
        // for (var i = 0; i < myVideos.length; i++) {
          // infos.textContent += myVideos[i].name + " duration: " + myVideos[i].duration + '\n';
        // }
        var info2 = document.getElementById('Feedback').innerHTML = "You can upload now!";
        document.getElementById("Feedback").style.color = 'green';
    }

    function check_size(){
        var file_input = document.getElementById("file");
        try{
            // alert(file_input.files[0].size); // Size returned in bytes.
            if (file_input.files[0].size > 100 * 1024 * 1024){
                document.getElementById("Feedback").innerHTML = "The file is too large!";
                return false;
            }
            else{
                document.getElementById("Feedback").innerHTML = "";
                return 1;
            }
        }catch(e){
            // alert("Error Detected");
            console.log(e)
            document.getElementById("Feedback").innerHTML = "Please choose a video to upload!";
            return 0;
        }
    }

    // function slice(file, start, end) {
    //     var slice = file.mozSlice ? file.mozSlice :
    //                 file.webkitSlice ? file.webkitSlice :
    //                 file.slice ? file.slice : noop;
    //
    //     return slice.bind(file)(start, end);
    // }
    //
    // function append_file(file, index){
    //     var form = document.getElementById("file");
    //     var child = document.createElement("input");
    //     input.setAttribute("type", "file");
    //     input.setAttribute("name", index);
    //     input.setAttribute("value", file);
    //     form.appendChild(child);
    // }
    //
    // function chop_and_append(file, start, end){
    //     var temp1 = slice(f, start, end);
    //     append_file(temp1, index);
    // }
    //
    // function chop_video(){
    //     //TODO
    //     var f = document.getElementById("file");
    //     var size = ori.size;
    //     var start = 0;
    //     var end = start + size;
    //
    //     while(size > end){
    //         chop_and_append(f, start, end);
    //     }
    //
    //     end = size;
    //     chop_loop(f, start, end);
    //
    // }

    function user_agreement(){
        // Show User Agreement Window
        $('#ModalLong').modal('show');

        //Set Timer

    }

    function final(){
        console.log("At final, submission_indicator=" + submission_indicator)
        temp2 = document.getElementById("file");
        console.log(temp2.files)
        if (temp2.files.length == 0){
            document.getElementById("Feedback").innerHTML = "Choose a video to upload.";
        }
        else if (submission_indicator){
            document.getElementById("Feedback").innerHTML = "";
            //Cut Video into chunks
            // chop_video();

            // temp1 = document.getElementById("form");
            // console.log(temp2.files)
            // console.log(temp1)
            // temp1.removeChild("")

            user_agreement();

            // temp1.submit();
        }
    }

    function check_email(){
        text = document.getElementById("staticEmail").value;
        text2 = document.getElementById("staticEmail2").value;
        if (text == "" || text2 == ""){
            document.getElementById("Email_Reminder").style.color = "red";
            document.getElementById("Email_Reminder").innerHTML = "Please fill in your email address to proceed.";
            return false;
        }
        if (text != text2){
            document.getElementById("Email_Reminder").style.color = "red";
            document.getElementById("Email_Reminder").innerHTML = "2 Email addresses not match!";
            return false;
        }
        return true;
    }

    function final2(){
        // console.log(document.getElementById("staticEmail").value)
        form = document.getElementById("form");
        text = document.getElementById("staticEmail").value;
        if (check_email()){
            document.getElementById("Email_Reminder").style.color = "green";
            document.getElementById("Email_Reminder").innerHTML = "Uploading...";
            var child = document.createElement("input");
            child.setAttribute("type", "hidden");
            child.setAttribute("name", "email");
            child.setAttribute("value", document.getElementById("staticEmail").value);
            form.appendChild(child);
            form.submit();
        }
    }
  </script>
  </html>
